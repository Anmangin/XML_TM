<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="style.css"> -->
     <style>
        /* Global Styles */
body {
    max-width: 902px; /* Largeur utilisable dans Word avec marges standards */
    margin: 0 auto; /* Centre le contenu horizontalement */
    padding: 0; /* Pas de marge interne suppl√©mentaire */
    font-family: 'Arial', sans-serif; /* Police standard Word */
    line-height: 1.5; /* Espacement de ligne standard dans Word */
    box-sizing: border-box; /* Garantit que le padding n'ajoute pas √† la largeur */
}
.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 250px;
    height: 100%;
    background-color: #f4f4f4;
    padding-top: 20px;
    padding-left: 10px;
    overflow-y: auto;
    border-right: 2px solid #ccc;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
}

.sidebar h3 {
    font-size: 20px;
    color: #333;
    margin-bottom: 15px;
}

/* Sidebar Links */
.sidebar a {
    display: block;
    padding: 10px;
    text-decoration: none;
    color: #333;
    font-size: 12px;
    margin-bottom: 0px;
    border-radius: 0px;
}

.sidebar a:hover {
    background-color: #ddd;
}


/* Styles g√©n√©raux de la sidebar */
.sidebar {
    width: 300px;
    padding: 10px;
    background-color: #f4f4f4;
    border-right: 2px solid #ccc;
}

.sidebar a {
    display: block;
    color: #007bff;
    text-decoration: none;
    padding: 5px;
    margin-bottom: 5px;
}

.sidebar a:hover {
    background-color: #ddd;
}

/* Ajouter une indentation pour les titres H2 dans la sidebar */
.sidebar a {
    padding-left: 0;
}

.sidebar a[data-target^="h2"] {
    padding-left: 20px;  /* Indentation pour les titres H2 */
}



/* Contenu Principal */
.content {
    margin-left: 50px; /* D√©calage pour laisser de la place √† la sidebar */
    padding: 20px;
    background-color: #fff;
    /* min-height: 100vh; */
    width:100%;
}

section {

    display: none;  
}
h1 {
display: none;
width:100%;
}

/* Titre */
h2, h3 {
    color: #3b7bc0;
    text-align: center;
    margin-bottom: 20px;
    width:100%;
}

h2 {
    font-size: 16px;
}

h3 {
    font-size: 14px;
    text-align: left; /* Aligne le texte √† gauche */
    background-color: #3b7bc0; /* Couleur de fond bleue */
    color: white; /* Couleur du texte */
    padding: 10px; /* Espacement interne */
    border-radius: 8px; /* Coins arrondis */
    margin: 10px 0; /* Espacement externe (haut et bas) */
    display: block; /* Assure que l'√©l√©ment prend toute la largeur disponible */
    width: 100%; /* Assure que l'√©l√©ment couvre toute la largeur */
    box-sizing: border-box; /* Inclut le padding dans la largeur totale */
}

/* Table Styles */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    background-color: #fff;
}

th, td {
     padding: 3px 5px; 
    text-align: left;
     border: 1px solid #dee2e6; 
}

th {
    background-color: #3b7bc0;
    color: #fff;
    text-align: center;
    font-weight: bold;
}

td {
    vertical-align: center;
    font-size: 10px;
}

tr:nth-child(even) {
    background-color: #f1f1f1;
}

/* Highlight Specific Content */
td b {
    color: #dc3545; /* Red for emphasis */
}

/* Details/Notes */
details {
    font-size: 0.9rem;
    background-color: #e9ecef;
    border: 1px solid #ced4da;
    border-radius: 5px;
    padding: 5px 10px;
    margin-top: 10px;
}

details summary {
    font-weight: bold;
    cursor: pointer;
    color: #495057;
}

/* List and Possible Responses */
ul {
    list-style-type: none;
    padding: 0;
}

li {
    margin: 5px 0;
}

/* Icon Styling */
td.center {
    text-align: center;
    font-size: 1.2rem;
}

td .red {
    color: rgba(255, 0, 0, 0.322);
}

/* Footnotes and Notes */
p {
    margin: 10px 0;
    font-size: 1rem;
    color: #6c757d;
    text-align: center;
}

code {
    background-color: #f8f9fa;
    padding: 3px 5px;
    border-radius: 3px;
    font-family: monospace;
    font-size: 0.9rem;
}



/* Cacher les sections avec la classe "hidden" */
.hidden {
    /* display: none !important;; Cache compl√®tement l'√©l√©ment */
    visibility: hidden  !important; /* L'√©l√©ment est invisible mais prend de la place */
}

/* Montrer les sections avec la classe "show" */
.show {
    display: block !important;; /* Affiche l'√©l√©ment en tant que bloc */
}

  @media print {
    h1 {
        page-break-before: always; /* Force un saut de page avant chaque h1 */
        text-align: center; /* Centre le texte */
        margin-top: 30%; /* Ajoute un espace avant le h1 pour le centrer verticalement */
        margin-bottom: 0; /* Enl√®ve la marge inf√©rieure pour √©viter de l'espace inutile apr√®s le h1 */
        width:100%;
    }
    h2 {
        page-break-before: always;
        padding: 0px; /* Espaces internes */
        margin-bottom: 0px;
        width:100%;
    }
    h3 {
        padding: 0px; /* Espaces internes */
        margin-bottom: 0px;
        width:100%;
    }
    section {
        padding: 0px; /* Espaces internes */
        margin-bottom: 0px;
        width:100%;
    }

    .sidebar {
        position: fixed; /* La sidebar reste fixe √† gauche */
        top: 0;
        left: 0;
        width: 250px;  /* Largeur normale de la sidebar */
        padding: 0px; /* Espaces internes */

        margin-left: 0mm;
        box-shadow: none; /* Enl√®ve l'ombre pendant l'impression */
        border:none;
        height: 100%;  /* Prend toute la hauteur de la page */
        padding: 5px;
        font-size: 10px; /* R√©duit la taille de la police pour s'ajuster */
        line-height: 1.05; /* R√©duit l'espacement entre les lignes pour plus de texte */
        display: block;
        page-break-inside: avoid; /* √âvite que la sidebar soit coup√©e entre les pages */
        page-break-before: always; /* Force la sidebar √† commencer sur chaque nouvelle page */
    }


    .sidebar a{
        padding: 0px; /* Espaces internes */
        margin: -0mm;
        font-size: 9pt; /* Ajuste la taille de la police pour l'impression */
    }
    .sidebar button{
        display: none !important;; /* Cache compl√®tement l'√©l√©ment */
    }
    .sidebar h3{
        display: none !important;; /* Cache compl√®tement l'√©l√©ment */
    }
    .content {
            width: 75%;  /* Largeur normale de la sidebar */
            padding: 0px; /* Espaces internes */
            margin-left: 270px;
            
    
        }

    
    /* Emp√™cher la coupure de l'√©l√©ment */
    body {
         max-width: 602px; /* Largeur utilisable dans Word avec marges standards */
         margin-left: 0mm; 
         font-size: 12pt; /* Ajuste la taille de la police pour l'impression */
    }
    .no-break {
        page-break-inside: avoid;
        break-inside: avoid; /* Pour les navigateurs modernes */
    }
    .no-print {
        display: none !important;
    }
}

#toggle-button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    background-color: #007BFF;
    color: white;
    border: none;
    border-radius: 5px;
}
#toggle-button.released {
    background-color: #6C757D;
}

/* Par d√©faut, les √©l√©ments sont cach√©s */
[data-visual="DM"] {
    display: table-cell;
}

.container {
    display: flex;
    flex-wrap: wrap; /* Permet aux √©l√©ments de se d√©placer sur plusieurs lignes si n√©cessaire */
}

.column {
    flex: 1 1 200px; /* Permet √† chaque colonne de cro√Ætre, de r√©tr√©cir, et d'avoir une largeur de base de 200px */
    margin: 10px;
}

.priority-column {
    flex: 2 1 200px; /* Cette colonne prend plus d'espace lorsqu'il y en a */
    
}

.center-content {
    text-align: center; /* Centre le contenu horizontalement */
}

.center-content button {
    display: inline-block; /* Permet de centrer le bouton */
}
     </style>
     <title> </title>
     
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <button id="toggle-button" class="pressed" data-state="DM">DM</button>
        <button id="print">imprimer les modifications</button>

      

        <script>
               // S√©lectionne le bouton et ajoute un √©couteur d'√©v√©nement
        // R√©cup√©rer le chemin de l'URL
        const pathname = window.location.pathname;

        // Extraire uniquement le nom du fichier
        let filename = pathname.substring(pathname.lastIndexOf('/') + 1);

        // D√©coder les caract√®res sp√©ciaux (comme %20 pour les espaces)
        filename = decodeURIComponent(filename);

        // Supprimer les extensions multiples (comme .html.pdf)
        filename = filename.replace(/\.(\w+)(\.\w+)+$/, ''); // Garde la premi√®re extension uniquement

        // Supprimer toute extension si n√©cessaire
        filename = filename.replace(/\.\w+$/, '');

        // Modifier le contenu de la balise <title>
        document.title = filename;
            // S√©lectionne le bouton et ajoute un √©couteur d'√©v√©nement
            document.getElementById('print').addEventListener('click', function () {
                // V√©rifie si le document contient un üî¥
                if (document.body.innerText.includes('üî¥')) {
                    // Obtenir la date actuelle et formater en YY.MM.DD
                    const now = new Date();
                    const year = String(now.getFullYear()).slice(-2); // Ann√©e sur 2 chiffres
                    const month = String(now.getMonth() + 1).padStart(2, '0'); // Mois sur 2 chiffres
                    const day = String(now.getDate()).padStart(2, '0'); // Jour sur 2 chiffres
        
                    // Ajouter -MOD:YY.MM.DD au nom du fichier
                    filename += `-MOD:${year}.${month}.${day}`;
                }
        
                // Mettre √† jour le titre de la page
                document.title = filename;
        
                // Lance la bo√Æte de dialogue d'impression
                window.print();
            });
        </script>


        <h3>Table des mati√®res</h3>
        <div id="sidebar-links"></div>
    </div>

    <!-- Main Content -->
    <div class="content" id="main-content">
    </div>
    <div class="content" id="change-log" style="margin-top: 20px;">
        <h3>Liste des changements √† faire</h3>
        <table id="change-table" border="1" style="border-collapse: collapse; width: 100%;">
            <thead>
                <tr>
                    <th>Fiche</th>
                    <th>caption</th>
                    <th>Description modifi√©</th>
                    <th>Response Type</th>
                    <th>SAS Name</th>
                </tr>
            </thead>
            <tbody id="change-list"></tbody>
        </table>
    </div>
    <script>
        function loadJSON(filePath) {
    return fetch(filePath) // Charge le fichier JSON √† partir du chemin sp√©cifi√©
        .then(response => {
            if (!response.ok) {
                throw new Error('Erreur lors du chargement du fichier JSON');
            }
            return response.json(); // Parse le contenu du fichier JSON
        })
        .then(data => {
            return data; // Renvoie les donn√©es JSON une fois qu'elles sont charg√©es
        })
        .catch(error => {
            console.error('Erreur:', error); // G√®re les erreurs
            return null; // Retourne null en cas d'erreur
        });
}
</script>



<script>

const jsonData = {"visites": [{"V_description": "Baseline", "fiches": [{"F_description": "Prior chemotherapy", "groupes": [{"G_description": "SYSTYN", "questions": [{"GI_key": "14ade046-d28a-4a1f-8277-555136d0dbad", "Item_Order": 1, "I_description": "Prior Chemotherapy / Target Therapy / Immunotherapy:", "I_caption": "SYSTYN", "Message": null, "rep": "\ud83d\udd18 1 - <b>Yes</b><br>\ud83d\udd18 0 - <b>No</b>", "I_Status": "", "i_SasName": "SYSTYN"}, {"GI_key": "3c8e379e-8c57-4f83-aff4-c7cac20448cc", "Item_Order": 2, "I_description": "Total number of prior anticancer lines\\r\\nPlease one line by prior anticancer lines in the following table.", "I_caption": "PACNB", "Message": "<details> <summary>1 EditCheck </summary><table><tr><td> Enabled:[Prior chemotherapy.*][SYSTYN.*][PACNB]</td> </tr><tr> <td> <pre><code class='javascript'>#Action Expression \n[Prior chemotherapy][SYSTYN][SYSTYN] == '1'; \n#data Expression \n \n</code></pre> </td><td> </td> </tr></table></details>", "rep": "Num - 2", "I_Status": "", "i_SasName": "PACNB"}]}, {"G_description": "SYST", "questions": [{"GI_key": "f84e0c0d-a6e2-43f7-a530-eb60d4b18952", "Item_Order": 3, "I_description": "Nature of treatment", "I_caption": "TRTTYP", "Message": null, "rep": "\ud83d\udd18 1 - <b>Chemotherapy & immunotherapy</b><br>\ud83d\udd18 2 - <b>Target therapy</b><br>\ud83d\udd18 3 - <b>Immunotherapy only</b><br>\ud83d\udd18 4 - <b>Chemotherapy only</b><br>\ud83d\udd18 5 - <b>other systemic treatment</b>", "I_Status": "", "i_SasName": "TRTTYP"}, {"GI_key": "fe8f5702-0026-4d05-9e9b-57b3875accbf", "Item_Order": 4, "I_description": "Name of protocol", "I_caption": "PROTO", "Message": null, "rep": "Char - 50", "I_Status": "", "i_SasName": "PROTO"}, {"GI_key": "d6379826-8dae-4cb7-b20e-3d1364cf1953", "Item_Order": 5, "I_description": "Treatment for", "I_caption": "PRFOR", "Message": null, "rep": "\ud83d\udd18 1 - <b>Locally/locally advanced disease</b><br>\ud83d\udd18 2 - <b>Metastatic disease</b>", "I_Status": "", "i_SasName": "PRFOR"}, {"GI_key": "5a35a4ac-f8d7-42d6-9fe1-cf44c584c40c", "Item_Order": 6, "I_description": "<b>Name of drugs\\r\\n</b>(one or more drugs in one row)<i>\\r\\n</i>", "I_caption": "DRG", "Message": null, "rep": "Char - 50", "I_Status": "", "i_SasName": "DRG"}, {"GI_key": "df5c0732-0aa5-4811-9e88-add729a8c2f6", "Item_Order": 7, "I_description": "Start date", "I_caption": "SYSTSDT", "Message": null, "rep": "\ud83d\udcc5 DD/MM/YYYY", "I_Status": "", "i_SasName": "SYSTSDT"}, {"GI_key": "2a26497e-eab4-4b4c-8f2d-7c21d8dbaa14", "Item_Order": 8, "I_description": "End date", "I_caption": "SYSTEDT", "Message": "<details> <summary>1 EditCheck </summary><table><tr><td> Valid:[Prior chemotherapy.*][SYST.*][SYSTEDT]</td> </tr><tr> <td> <pre><code class='javascript'>#Action Expression \nvar db=[Prior chemotherapy][SYST.@][SYSTSDT];\nvar fn = [Prior chemotherapy][SYST.@][SYSTEDT];\n\nisDate1LEDate2(db,fn); \n#data Expression \n \n</code></pre> </td><td> la date de fin est avant la date de d\u00e9but, merci de corriger.</td> </tr></table></details>", "rep": "\ud83d\udcc5 DD/MM/YYYY", "I_Status": "", "i_SasName": "SYSTEDT"}, {"GI_key": "0fdf8444-434e-4e88-bbd2-e7658f24c05f", "Item_Order": 9, "I_description": "Reason of stop", "I_caption": "PRSTOP_R", "Message": null, "rep": "\ud83d\udd18 1 - <b>Progression</b><br>\ud83d\udd18 2 - <b>Toxicity</b><br>\ud83d\udd18 3 - <b>Complete remission</b><br>\ud83d\udd18 4 - <b>Partial remission</b><br>\ud83d\udd18 5 - <b>End of protocole</b><br>\ud83d\udd18 6 - <b>Patient's choice</b><br>\ud83d\udd18 7 - <b>Other, please specify</b>", "I_Status": "", "i_SasName": "PRSTOP_R"}, {"GI_key": "c5d7271e-3037-4c14-a2e7-72d058a1beb5", "Item_Order": 10, "I_description": "other reason, please specify", "I_caption": "PRSTOP_S", "Message": null, "rep": "Char - 50", "I_Status": "", "i_SasName": "PRSTOP_S"}, {"GI_key": "d2773af6-48b3-4860-90f6-97eb04d4e363", "Item_Order": 11, "I_description": "Date of progression", "I_caption": "PRPROGDT", "Message": "<details> <summary>1 EditCheck </summary><table><tr><td> Enabled:[Prior chemotherapy.*][SYST.*][PRPROGDT]</td> </tr><tr> <td> <pre><code class='javascript'>#Action Expression \n[Prior chemotherapy][SYST.@][PRSTOP_R] == '1' \n#data Expression \n \n</code></pre> </td><td> </td> </tr></table></details>", "rep": "\ud83d\udcc5 DD/MM/YYYY", "I_Status": "", "i_SasName": "PRPROGDT"}]}]}]}]};


const exportData  = {};
const sidebarLinks = document.getElementById('sidebar-links');
const mainContent = document.getElementById('main-content');

// G√©n√©rer les liens dynamiquement √† partir des visites et fiches
jsonData.visites.forEach((visite, visitIndex) => {
    const vindex= `v${visitIndex}`
    visite.visitIndex = visitIndex;

    // Cr√©er un lien pour la visite
    const visitLink = document.createElement('a');
    visitLink.href =`#${vindex}`;
    visitLink.style = "background-color: #ADD8E6; color: black; padding: 5px; border-radius: 5px; text-decoration: none;";
    visitLink.className = `visit`;
    visitLink.innerText = `${visitIndex + 1}: ${visite.V_description}`;
	generateFiches(visite,vindex);  
    visitLink.addEventListener('click', () => {
        console.log(visitLink.href)
        visibleonly(jsonData, 'visite', vindex);
    });
    sidebarLinks.appendChild(visitLink);

    // Parcourir les fiches de la visite
    visite.fiches.forEach((fiche, ficheIndex) => {
        const findex=`v${visitIndex}f${ficheIndex}`;
        fiche.ficheIndex = findex;

        // Cr√©er un lien pour la fiche
        const ficheLink = document.createElement('a');
        ficheLink.href = `#${findex}`;
        ficheLink.className = `form`; // Utilisez `className` ici
        ficheLink.style="margin-left: 20px;"
        ficheLink.innerText = `${ficheIndex + 1}: ${fiche.F_description}`;
        ficheLink.addEventListener('click', () => {
            visibleonly(visite, 'fiche', findex);
        });
        sidebarLinks.appendChild(ficheLink);
    });
});

// Fonction visibleonly
function visibleonly(data, type, index) {

    if (type === 'visite') {

        let h1list = document.getElementsByTagName('h1');

        for (let visit of h1list) {
        // G√©rer la visibilit√© des visites
       
       if (visit.id==index){
        console.log("analyse de",visit,'trouv√©',index);
        visit.classList.remove('hidden');
        visit.classList.add('show');
        } else {
            console.log("analyse de",visit,'cach√©' , index);
            visit.classList.remove('show');
            visit.classList.add('hidden');
        }



        };

        let sectionlist = document.getElementsByTagName('section');

        for (let section of sectionlist) {
            sectionid=section.id.split('f')[0];;
            if (sectionid==index) {
                section.classList.remove('hidden');
                section.classList.add('show');
            }
        else {
                section.classList.remove('show');
                section.classList.add('hidden');
            }
        }



    } else if (type === 'fiche') {

        let sectionlist = document.getElementsByTagName('section');

        for (let section of sectionlist) {
            sectionid=section.id;
            if (sectionid==index) {
                section.classList.remove('hidden');
                section.classList.add('show');
            }
        else {
                section.classList.remove('show');
                section.classList.add('hidden');
            }
        }

    }
}

// Fonction pour ajouter l'√©couteur d'√©v√©nements de mani√®re globale
function updateExportData(td1, td2, td3) {
    const formKey = td1.getAttribute("data-form");
    const sourceKey = td1.getAttribute("data-source");
    const datacaption = td1.getAttribute("data-caption");
    const dataorder = td1.getAttribute("data-order");

    const sourceresp = td2.getAttribute("data-source");
    const sourceSAS = td3.getAttribute("data-source");
    console.log(sourceSAS)

    // R√©cup√©rer les valeurs actuelles des cellules
    const currentDescription = td1.innerText;
    const currentResponseType = td2.innerText;
    const currentSasName = td3.innerText;

    // R√©cup√©rer les valeurs modifi√©es des champs de saisie
    const modifyTXT1 = document.getElementById(aeraID + '1').value;
    const modifyHTML2 = document.getElementById(aeraID + '2').value;
    const modifyTXT3 = document.getElementById(aeraID + '3').value;
    const displayTxT1 = (modifyTXT1 === sourceKey) ? "N/A" : modifyTXT1;
    const displayTxT2 = (modifyHTML2 === sourceresp) ? "N/A" : modifyHTML2;
    const displayTxT3 = (modifyTXT3 === sourceSAS) ? "N/A" : modifyTXT3;

    // V√©rifier s'il y a un changement
    if (modifyTXT1 !== currentDescription || modifyHTML2 !== currentResponseType || modifyTXT3 !== currentSasName) {
        // Si des changements sont d√©tect√©s, mettre √† jour l'objet exportData
        if (!exportData[formKey]) {
            exportData[formKey] = {}; // Initialiser l'objet pour le formulaire s'il n'existe pas
        }
        exportData[formKey][datacaption] = {
            dataorder:dataorder,
            description: displayTxT1,
            responseType: displayTxT2,
            sasName: displayTxT3
        };

        // Appeler la fonction de mise √† jour de la liste des changements
        updateChangeLog();
    }
}

function addGlobalClickListener() {
    document.addEventListener('click', (event) => {
        if (event.target && (event.target.innerHTML === '‚úèÔ∏è' || event.target.innerHTML === 'üíæ')) {
            originID = event.target.getAttribute("id").substr(3);

            td0 = document.getElementById('td0' + originID);
            td1 = document.getElementById('td1' + originID);
            td2 = document.getElementById('td2' + originID);
            td3 = document.getElementById('td3' + originID);
            But = document.getElementById("But" + originID);

            aeraID = 'ARE' + originID;

            if (event.target && event.target.innerHTML === '‚úèÔ∏è') {
                // R√©cup√©rer les valeurs existantes
                previousTXT = td1.innerHTML;
                previousHTML2 = td2.innerHTML; // Contenu de td2
                previousTXT3 = td3.innerText;

                // Remplacer le texte statique par des champs texte (textarea)
                td1.innerHTML = '';
                td2.innerHTML = '';
                td3.innerHTML = '';

                const inputField1 = document.createElement('textarea');
                inputField1.id = aeraID + '1';
                inputField1.innerText = previousTXT || ''; // Valeur actuelle de td1
                td1.appendChild(inputField1);

                const inputField2 = document.createElement('textarea');
                inputField2.id = aeraID + '2';
                inputField2.innerText = previousHTML2; // Valeur actuelle de td2
                td2.appendChild(inputField2);

                const inputField3 = document.createElement('textarea');
                inputField3.id = aeraID + '3';
                inputField3.innerText = previousTXT3 || ''; // Valeur actuelle de td3
                td3.appendChild(inputField3);

                // Cr√©er un bouton "Save"
                td0.innerHTML = '';
                const saveButton = document.createElement('button');
                saveButton.id = "But" + originID;
                saveButton.innerHTML = 'üíæ';
                td0.appendChild(saveButton);
            }

            // Quand on clique sur "Save", sauvegarder la modification
            if (event.target && event.target.innerHTML === 'üíæ') {
                updateExportData(td1, td2, td3);
                console.log(exportData)
                const modifyTXT1 = document.getElementById(aeraID + '1').value;
                const modifyHTML2 = document.getElementById(aeraID + '2').value;
                const modifyTXT3 = document.getElementById(aeraID + '3').value;

              

                // Mise √† jour de td1, td2, et td3 avec les nouvelles valeurs
                td1.innerHTML = modifyTXT1;
                td2.innerHTML = modifyHTML2;
                td3.innerHTML = modifyTXT3;

                // Remise √† z√©ro de td0 et ajout du bouton "Modifier"
                td0.innerHTML = '';
                const modButton = document.createElement('button');
                modButton.id = "But" + originID;
                modButton.innerHTML = 'üî¥‚úèÔ∏è';
                td0.appendChild(modButton);
            }
        }
    });
}


         addGlobalClickListener()        
// Fonction pour g√©n√©rer les fiches
function generateFiche(fiche, activate, fid) {
    // Cr√©er la section
    const section = document.createElement('section');
    section.id = `${fid}`;
    section.className="no-break"

    const h2 = document.createElement('h2');
        h2.innerText = fiche.F_description;
        section.appendChild(h2);
    // Parcourir les groupes
    fiche.groupes.forEach(groupe => {
        // Ajouter un titre pour le groupe
        const h3 = document.createElement('h3');
        h3.innerText = groupe.G_description;
        section.appendChild(h3);

        // Cr√©er une table pour les questions
        const table = document.createElement('table');
        table.className="no-break"

        // Ajouter l'en-t√™te de la table
        const headerRow = document.createElement('tr');
        const th0 = document.createElement('th');
        th0.innerText = 'üõ†Ô∏è';
        th0.style.width = '1px';
        th0.style.whiteSpace = 'nowrap';
        th0.setAttribute('data-visual', "DM");
        const th1 = document.createElement('th');
        th1.innerText = 'Question Description';

        const th2 = document.createElement('th');
        th2.innerText = 'Response';
        const th3 = document.createElement('th');
        th3.innerText = 'Sas';
        th3.setAttribute('data-visual', "DM");
        const th4 = document.createElement('th');
        th4.innerText = 'EditCheck';
        th4.setAttribute('data-visual', "DM");
        th4.className="no-print";
        const th5 = document.createElement('th');
        th5.innerText = 'Report';
        th5.setAttribute('data-visual', "DM");
        th5.className="no-print";



        headerRow.appendChild(th0);
        headerRow.appendChild(th1);
        headerRow.appendChild(th2);
        headerRow.appendChild(th3);
        headerRow.appendChild(th4);
        headerRow.appendChild(th5);

        table.appendChild(headerRow);

        // Ajouter les lignes pour chaque question
        index=0
        groupe.questions.forEach(question => {
            index+=1
            const row = document.createElement('tr');

            // Colonne pour l'outil
            const td0 = document.createElement('td');
            td0.setAttribute('data-visual', "DM");
            td0.id = `td0${question.GI_key}`;
            const editButton = document.createElement('button');
            editButton.innerHTML = '‚úèÔ∏è';
            editButton.id = `But${question.GI_key}`;
            editButton.className="no-print";
            td0.appendChild(editButton);

            // Colonne pour la description
            const td1 = document.createElement('td');
            td1.innerHTML = question.I_description || 'N/A';
            td1.id = `td1${question.GI_key}`;
            td1.setAttribute('data-source', question.I_description);
            td1.setAttribute('data-form', fiche.F_description);
            td1.setAttribute('data-caption', question.I_caption);
            td1.setAttribute('data-order', question.Item_Order);
            

            // Colonne pour la r√©ponse
            const td2 = document.createElement('td');
            td2.innerHTML = question.rep || 'N/A';
            td2.id = `td2${question.GI_key}`;
            td2.setAttribute('data-source', question.rep);

            const td3 = document.createElement('td');
            td3.innerHTML = question.i_SasName || 'N/A';
            td3.setAttribute('data-visual', "DM");
            td3.id = `td3${question.GI_key}`;
            td3.setAttribute('data-source', question.i_SasName);

            const td4 = document.createElement('td'); // Cr√©e une cellule de tableau
            td4.setAttribute('data-visual', "DM");
            td4.className="no-print";

            
            td4.innerHTML = question.Message; // Ajoute l'emoji au bouton
            
            const td5 = document.createElement('td'); // Cr√©e une cellule de tableau
            td5.classList.add('center-content'); // Ajoute la classe pour le centrage

            td5.setAttribute('data-visual', "DM");
            td5.className="no-print";
            const issue = document.createElement('button'); // Cr√©e un bouton
            issue.innerHTML = "‚ùó"; // Ajoute l'emoji au bouton
            issue.id = "report-issue"; // Donne un ID au bouton
            issue.setAttribute('data-fiche', fiche.F_description);
            issue.setAttribute('data-question', question.I_description);
            issue.setAttribute('data-SasName', question.i_SasName);
            issue.addEventListener('click', () => {
                const ficheDescription = event.target.getAttribute('data-fiche');
                const questionDescription = event.target.getAttribute('data-question');
                const SasName = event.target.getAttribute('data-SasName');

                // Remplacez l'URL avec votre propre logique
                title= ` Probl√®me avec ${ficheDescription} SasName:${SasName}`;
                description = `# Probl√®me identifi√© sur : \n## fiche:${ficheDescription} \n### SasName:${SasName} \n\n question= ${questionDescription} \n\n d√©tail :`;

                const url = `https://github.com/Anmangin/XML_TM/issues/new?title=${encodeURIComponent(title)}&body=${encodeURIComponent(description)}&labels=bug`;
                window.open(url, '_blank');
            });

            td5.appendChild(issue); // Ajoute le bouton √† la cellule

            
            // Ajouter les colonnes √† la ligne
            
            row.appendChild(td0);
            row.appendChild(td1);
            row.appendChild(td2);
            row.appendChild(td3);
            row.appendChild(td4);
            row.appendChild(td5);


            // Ajouter la ligne au tableau
            table.appendChild(row);
            const rowp = document.createElement('tr');
rowp.style.position = "relative"; // Position de la ligne pour utiliser la position absolue de la cellule
rowp.style.height = "0px"; // Hauteur de la ligne
rowp.style.overflow = "hidden"; // Permet au contenu de d√©passer la hauteur
rowp.style.visibility = "hidden"; // Masque la ligne, mais pas son contenu

// const tdx = document.createElement('td');
// tdx.colSpan = 6; // Ajustez selon le nombre de colonnes
// tdx.style.position = "absolute"; // Permet de positionner le texte par-dessus le tableau
// tdx.style.top = "0px"; // Positionne le texte √† l'endroit souhait√© (ajustez si n√©cessaire)
// tdx.style.left = "0px"; // Positionne le texte √† l'endroit souhait√© (ajustez si n√©cessaire)
// tdx.style.textAlign = 'left';
// tdx.style.zIndex = "10"; // Place le texte au-dessus des autres √©l√©ments (ajustez si n√©cessaire)
// tdx.textContent = '+'; // Contenu du texte

// // Ajoutez la cellule au tableau
// rowp.appendChild(tdx);
// table.appendChild(rowp);

          
        });

            // Ajouter une ligne de s√©paration "+" apr√®s chaque ligne sauf la derni√®re
   

        // Ajouter la table √† la section
        section.appendChild(table);
    });

    // Ajouter la section au contenu principal
    mainContent.appendChild(section);
}



window.addEventListener('beforeunload', (event) => {
    // Vous pouvez d√©finir un message personnalis√© (en fonction du navigateur, il peut ne pas s'afficher)
    const message = "√ätes-vous s√ªr de vouloir quitter cette page ? Toutes les modifications non enregistr√©es seront perdues.";

    // Certains navigateurs ne tiennent pas compte du message personnalis√©,
    // mais l'√©v√©nement doit √™tre annul√© pour afficher l'avertissement.
    event.returnValue = message;  // Standard
    return message;  // Pour certains navigateurs (comme Chrome)
});
        // Function to generate all fiches for a visit
        function generateFiches(visite,vid) {

            const h1 = document.createElement('h1');
            h1.innerText = "Visite " + visite.V_description;
            h1.id = `${vid}`
            mainContent.appendChild(h1);
     
            n=0
            activate=true;
            Fidex=0

            visite.fiches.forEach(fiche => {               
                generateFiche(fiche,activate,`${vid}f${Fidex}`); // Use the same function to generate each fiche in the visit
                Fidex += 1;
                activate=false;


                
            });
      
        }

    

    </script>

<script>
   
    // R√©cup√®re le bouton et ajoute un √©v√©nement de clic
    const toggleButton = document.getElementById('toggle-button');

    toggleButton.addEventListener('click', () => {
        const currentState = toggleButton.getAttribute('data-state');
        let newState, buttonText;

        // Basculer entre les deux √©tats
        if (currentState === "DM") {
            newState = "Investigateur";
            buttonText = "Investigateur";
            toggleButton.classList.remove('pressed');
            toggleButton.classList.add('released');
        } else {
            newState = "DM";
            buttonText = "DM";
            toggleButton.classList.remove('released');
            toggleButton.classList.add('pressed');
        }

        // Met √† jour l'√©tat du bouton
        toggleButton.setAttribute('data-state', newState);
        toggleButton.innerText = buttonText;

        // Afficher/Masquer les √©l√©ments en fonction de l'√©tat
        document.querySelectorAll('[data-visual]').forEach(el => {
            if (el.getAttribute('data-visual') === newState) {
                el.style.display = "table-cell";
            } else {
                el.style.display = "none";
            }
        });
    });

    // Afficher initialement les √©l√©ments de l'√©tat par d√©faut (DM)
    document.querySelectorAll('[data-visual="DM"]').forEach(el => {
        el.style.display = "table-cell";
    });




        let h1list = document.getElementsByTagName('h1');
        let sectionlist = document.getElementsByTagName('section');

        for (let section of sectionlist) {
                section.classList.remove('hidden');
                section.classList.add('show');
        }

        for (let title of h1list) {
            title.classList.remove('hidden');
            title.classList.add('show');
        }

// Fonction pour afficher les changements dans la section du tableau


function updateChangeLog() {
    const changeList = document.getElementById('change-list');
    changeList.innerHTML = ''; // R√©initialiser le corps du tableau avant de le remplir
    console.log(exportData)
    // V√©rifier s'il y a des modifications enregistr√©es
    if (Object.keys(exportData).length > 0) {
        // Trier l'objet exportData par la propri√©t√© dataorder
        const sortedEntries = Object.entries(exportData).sort(([, a], [, b]) => a.dataorder - b.dataorder);
        
        for (const [formKey, formValue] of sortedEntries) {
            for (const [sourceKey, value] of Object.entries(formValue)) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formKey}</td>
                    <td>${sourceKey}</td>
                    <td>${value.description}</td>
                    <td>${value.responseType}</td>
                    <td>${value.sasName}</td>
                `;
                changeList.appendChild(row);
            }
        }
    } else {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td colspan="5" style="text-align: center;">Aucun changement enregistr√©.</td>
        `;
        changeList.appendChild(row);
    }
}

</script>


</body>

</html>
